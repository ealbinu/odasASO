Vue.component("drag",{props:["dropzone","dragsound","dropsound","isoksound","data","returnIfError","returnToPosition","stayInDrop","stayIfOk","dropzoneOkClass","dropzoneOkRemoveClass","dropzoneErrorClass","dragOkClass","dragErrorClass","particleColor","initclass","dragLine","appendToDropzone","appendClone","disableok","returnToLastPosition","singleDetection","noErrorSound","noOkSound","noReturnOnDrop","noAnimations","undroppable","extval","isfalse","c"],data:()=>({posx:0,posy:0,dragPosX:0,dragPosY:0,draggable:null,canvas:null,ctx:null,lastPosition:{x:0,y:0},dropzonesDetected:0,isItOk:!1,clonedIn:[],dragoks:0,oktimes:0,state:"unset",csscolors:["#5fa7a3","#5EB246","#005093","#00A9CB","#EB8B2E","#5EB246","#DB3E34","#F460AB","#A6881F","#C75980"]}),template:'\n        <div ref="drag" :class="\'drag \' + (initclass!=undefined?initclass:\'\')" :oktimes="oktimes">\n            <slot></slot>\n        </div>\n    ',methods:{init(){var t=this;t.posx=t.$refs.drag.offsetLeft,t.posy=t.$refs.drag.offsetTop,t.$refs.drag.children[0].classList.add("animate__animated"),t.draggable=Draggable.create(t.$refs.drag,{type:"x,y",bounds:".activity",onDragStart:function(s){t.DragStart(s)},onDrag:function(s){t.Drag(s)},onDragEnd:function(s){t.DragEnd(s)},onPress:function(){t.lastPosition.x=this.x,t.lastPosition.y=this.y}}),t.dragLineFnInit()},DragStart(t){var s=this;s.$emit("dragstarted"),app.particleAnimation(t,null,null,null,s.csscolors[s.c]||s.particleColor),s.setClassAnimation("start"),s_select.play(),s.playDragSound(),s.dragPosX=t.clientX+window.scrollX,s.dragPosY=t.clientY+window.scrollY,s.dropzonesDetected=0,null==s.undroppable&&null==s.extval||s.undroppableFn()},Drag(t){var s=this;s.HitTestFn(t,!1),s.dragLineFn(t)},DragEnd(t){var s=this;app.particleAnimation(t,null,null,null,s.csscolors[s.c]||s.particleColor),s.HitTestFn(t,!0),s.playDropSound()},playDragSound(){var t;this.dragsound&&new Howl({src:[this.dragsound]}).play()},playDropSound(){if(this.dropsound){var t=this,s;new Howl({src:[this.dropsound],onend:function(){t.$emit("dropsoundCompleted")}}).play()}},setClassAnimation(t){var s=this,e;switch(t){case"start":e="animate__rubberBand";break;case"error":e="animate__wobble";break;case"ok":e="animate__flash";break}s.$refs.drag.children[0]&&s.$refs.drag.children[0].classList.add(e),setTimeout((function(){s.$refs.drag.children[0]&&s.$refs.drag.children[0].classList.remove(e)}),1e3)},undroppableFn(t){for(var s=this,e=document.querySelectorAll(s.dropzone),r=0,i=0;i<e.length;i++){var o=e[i];if(Draggable.hitTest(s.$refs.drag,o,"100%")){var n=o.getAttribute("droppedtimes"),a=(n=parseInt(n))>0?n-1:0;o.setAttribute("droppedtimes",a)}}},HitTestFn(t,s){for(var e=this,r=document.querySelectorAll(e.dropzone),i=0,o=0;o<r.length;o++){var n=r[o];Draggable.hitTest(e.$refs.drag,n,"50%")?s?(i++,e.dropHitTest(n,t)):e.hoverHitTest(n,t):s||e.hoverExitHitTest(n,t)}e.state="set",s&&0==i&&(e.backToInitPos(),e.$emit("notdropped"),e.isItOk=void 0)},hoverHitTest(t,s){var e=this;if(!this.dropzoneCanBeDropped(t))return!1;t.classList.contains("hover")||(t.classList.add("hover"),s_select.play())},hoverExitHitTest(t,s){t.classList.contains("hover")&&t.classList.remove("hover")},dropHitTest(t,s){var e=this;return e.dropzonesDetected++,t.classList.contains("hover")&&t.classList.remove("hover"),!(null!=e.singleDetection&&e.dropzonesDetected>1)&&(e.dropzoneCanBeDropped(t)?(t.classList.add("dropzoneused"),void(this.data==t.getAttribute("data")?e.hitTestISOK(t,s):e.hitTestISERROR(t,s))):(e.backToInitPos(),s_error.play(),!1))},hitTestISOK(t,s){var e;if((e=this).$emit("dropped"),null==e.noOkSound&&null==e.extval&&s_ok.play(),null!=e.isoksound){var e=this,r;new Howl({src:[e.isoksound],onend:function(){e.$emit("isoksoundcompleted")}}).play()}setTimeout((function(){let s=t.getAttribute("droppedtimes");e.dragoks++,e.$emit("isok",{droppedtimes:s,dragoks:e.dragoks}),e.isItOk=!0}),100),e.returnToPositionFn(),e.stayInDropFn(),e.dropzoneStatusClass("ok",t),e.dropzoneSound(t,"oksound"),e.dragStatusClass("ok"),e.stayIfOkFn(),app.particleAnimation(s,100,null,null),null==e.noAnimations&&null==e.extval&&e.setClassAnimation("ok"),e.droppedtimesAdd(t),e.appendToDropzoneFn(t,s),e.appendCloneToDropzoneFn(t,s),null==e.disableok&&null==e.extval&&EventBus.$emit("isok"),e.oktimes+=1},hitTestISERROR(t,s){var e=this;e.$emit("iserror"),e.isItOk=!1,e.stayInDropFn(),e.dropzoneStatusClass("error",t),e.dropzoneSound(t,"errorsound"),null==e.noReturnOnDrop&&null==e.extval||e.droppedtimesAdd(t),e.appendCloneToDropzoneFn(t,s),null==e.noReturnOnDrop&&null==e.extval&&(e.returnToPositionFn(),e.returnIfErrorFn()),e.dragStatusClass("error"),EventBus.$emit("iserror"),null==e.noAnimations&&null==e.extval&&e.setClassAnimation("error"),null==e.noErrorSound&&null==e.extval&&s_error.play()},appendToDropzoneFn(t,s){if(null!=this.appendToDropzone){var e=this.$refs.drag.children[0];t.append(e),TweenLite.to(this.$refs.drag,.5,{x:0,y:0})}},appendCloneToDropzoneFn(t,s){if(null!=this.appendClone){var e=this.$refs.drag.children[0].cloneNode(!0);t.getAttribute("data")==this.data?(e.setAttribute("isright",!0),this.isItOk=!0):(e.setAttribute("isright",!1),this.isItOk=!1),e.setAttribute("isclone",!0),null!=this.isfalse&&e.setAttribute("isfalse",!0),t.append(e),this.$refs.drag.setAttribute("wascloned",!0),this.clonedIn.push(t)}},dropzoneCanBeDropped(t){if("multiple"==t.getAttribute("droptimes")){var s=parseInt(t.getAttribute("droplimit"));if(s){var e=t.getAttribute("droppedtimes");return!e||e<s}return!0}return"once"==t.getAttribute("droptimes")?!t.classList.contains("dropzoneused"):"untilok"==t.getAttribute("droptimes")?!t.classList.contains(this.dropzoneOkClass):void 0},droppedtimesAdd(t){if("multiple"!=t.getAttribute("droptimes"))return!1;var s=t.getAttribute("droppedtimes");if(s){var e=parseInt(s)+1;t.setAttribute("droppedtimes",e)}else t.setAttribute("droppedtimes",1)},dropzoneStatusClass(t,s){var e=this;"ok"==t&&null!=e.dropzoneOkClass&&(s.classList.add(e.dropzoneOkClass),s.classList.contains(e.dropzoneErrorClass)&&s.classList.remove(e.dropzoneErrorClass)),"error"==t&&null!=e.dropzoneErrorClass&&(s.classList.add(e.dropzoneErrorClass),s.classList.contains(e.dropzoneOkClass)&&s.classList.remove(e.dropzoneOkClass))},dragStatusClass(t){var s=this;"ok"==t&&null!=s.dragOkClass&&(s.$refs.drag.classList.add(s.dragOkClass),s.$refs.drag.classList.contains(s.dragErrorClass)&&s.$refs.drag.classList.remove(s.dragErrorClass)),"error"==t&&null!=s.dragErrorClass&&(s.$refs.drag.classList.add(s.dragErrorClass),s.$refs.drag.classList.contains(s.dragOkClass)&&s.$refs.drag.classList.remove(s.dragOkClass))},stayIfOkFn(){null!=this.stayIfOk&&this.draggable[0].disable()},stayInDropFn(){var t=this;null!=t.stayInDrop?t.draggable[0].disable():t.returnToPositionFn()},returnToPositionFn(){null!=this.returnToPosition&&(this.backToInitPos(),null==this.undroppable&&null==this.extval||this.undroppableFn())},returnIfErrorFn(){null!=this.returnIfErrorFn&&this.backToInitPos(),null==this.undroppable&&null==this.extval||this.undroppableFn()},reset(){this.lastPosition.x=0,this.lastPosition.y=0,this.backToInitPos(),s_select.play()},backToInitPos(){if(null!=this.returnToLastPosition)return TweenLite.to(this.$refs.drag,.5,{x:this.lastPosition.x,y:this.lastPosition.y,top:this.posy,left:this.posx,delay:.6}),!1;TweenLite.to(this.$refs.drag,.5,{x:0,y:0,top:0,left:0,delay:.6}),this.dragLineClear()},dropzoneSound(t,s){var e;t.getAttribute(s)&&new Howl({src:[t.getAttribute(s)]}).play()},dragLineDraw(t){var s={};return s.x=this.dragPosX,s.y=this.dragPosY,s.color=this.csscolors[this.c]||this.particleColor,s.lineWith=4,s.draw=function(){ctx.beginPath(),ctx.lineWidth=s.lineWith,ctx.strokeStyle=s.color,ctx.moveTo(s.x,s.y),ctx.lineTo(t.clientX,t.clientY),ctx.stroke()},s},dragLineFnInit(){var t;null!=this.dragLine&&(this.canvas=document.createElement("canvas"),this.canvas.setAttribute("class","dragLineCanvas"),document.getElementsByClassName("scene")[0].appendChild(this.canvas),this.updateCanvas(),this.ctx=this.canvas.getContext("2d"))},updateCanvas(){if(null!=this.dragLine){var t=document.getElementsByClassName("scene")[0];this.canvas.width=2*t.clientWidth,this.canvas.height=2*t.clientHeight,this.canvas.style.width=t.clientWidth+"px",this.canvas.style.height=t.clientHeight+"px",this.canvas.getContext("2d").scale(2,2)}},dragLineFn(t){null!=this.dragLine&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.lineWidth=2,this.ctx.strokeStyle=this.csscolors[this.c]||this.particleColor,this.ctx.arc(this.dragPosX,this.dragPosY,20,0,2*Math.PI),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(this.dragPosX,this.dragPosY,10,0,2*Math.PI),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.lineWidth=6,this.ctx.strokeStyle=this.csscolors[this.c]||this.particleColor,this.ctx.lineCap="round",this.ctx.setLineDash([5,10]),this.ctx.moveTo(this.dragPosX,this.dragPosY),this.ctx.lineTo(t.clientX+window.scrollX,t.clientY+window.scrollY),this.ctx.stroke())},dragLineClear(){null!=this.dragLine&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},updatePositionFn(t){null!=this.updatePosition&&(this.posx=t.clientX+window.scrollX,this.posy=t.clientY+window.scrollY)},removeClones(){for(var t in this.clonedIn){let r=this.clonedIn[t],i=r.querySelectorAll('[isright="false"]');if(r.classList.remove("dropzoneused"),null!=this.undroppable||this.extval){var s=r.getAttribute("droppedtimes"),e=(s=parseInt(s))>0?s-1:0;r.setAttribute("droppedtimes",e)}this.state="unset",i[0].remove()}this.$refs.drag.removeAttribute("wascloned"),this.clonedIn=[]},externalValidation(){let t=!1;return 1==this.isItOk?t=!0:(t=null!=this.isfalse&&"unset"==this.state,this.undroppableFn(),this.backToInitPos(),this.removeClones()),t}},mounted(){this.init(),window.addEventListener("resize",this.updateCanvas)}});